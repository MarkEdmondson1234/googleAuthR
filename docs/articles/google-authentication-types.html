<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Google authentication types for R • googleAuthR</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Google analytics --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47480439-2', 'auto');
  ga('send', 'pageview');

</script>
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">googleAuthR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/google-authentication-types.html">
    <span class="fa fa-sign-in fa-lg"></span>
     
    Authentication
  </a>
</li>
<li>
  <a href="../articles/building.html">
    <span class="fa fa-wrench fa-lg"></span>
     
    Building Google APIs
  </a>
</li>
<li>
  <a href="../articles/advanced-building.html">
    <span class="fa fa-space-shuttle fa-lg"></span>
     
    Advanced APIs
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Help
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../reference/index.html">Reference</a>
    </li>
    <li>
      <a href="../news/index.html">News</a>
    </li>
    <li>
      <a href="../articles/troubleshooting.html">Troubleshooting</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://developers.google.com/apis-explorer/">
    <span class="fa fa-google fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/MarkEdmondson1234/googleAuthR/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://docs.google.com/forms/d/e/1FAIpQLSerjirmMpB3b7LmBs_Vx_XPIE9IrhpCpPg1jUcpfBcivA3uBw/viewform">
    <span class="fa fa-slack fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Google authentication types for R</h1>
                        <h4 class="author">Mark Edmondson</h4>
            
            <h4 class="date">2017-11-13</h4>
          </div>

    
    
<div class="contents">
<div id="basic" class="section level1">
<h1 class="hasAnchor">
<a href="#basic" class="anchor"></a>Basic</h1>
<p>Once setup, then you should go through the Google login flow in your browser when you run this command:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">googleAuthR<span class="op">::</span><span class="kw"><a href="https://code.markedmondson.me/googleAuthR//reference/gar_auth.html">gar_auth</a></span>()</code></pre></div>
<p>If you ever need to authenticate with a new user, use:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">googleAuthR<span class="op">::</span><span class="kw"><a href="https://code.markedmondson.me/googleAuthR//reference/gar_auth.html">gar_auth</a></span>(<span class="dt">new_user=</span><span class="ot">TRUE</span>)</code></pre></div>
<p>Authentication token is cached in a hidden file called <code>.httr-oauth</code> in the working directory.</p>
<div id="multiple-authentication-tokens" class="section level2">
<h2 class="hasAnchor">
<a href="#multiple-authentication-tokens" class="anchor"></a>Multiple authentication tokens</h2>
<p>If you supply a filename to <code><a href="https://code.markedmondson.me/googleAuthR//reference/gar_auth.html">googleAuthR::gar_auth(token = "filename")</a></code> then it will save the token there. If it doesn’t exist, it will make a new one, if it does exist it will attempt to read the token from that file.</p>
<p>You can use different token names to save different authentication settings such as with different scopes and client Ids.</p>
<p>An example switching between <code>googleAnalyticsR</code> and <code>searchConsoleR</code> authentication, assuming you have previously authenticated with two tokens, one name <code>ga.httr-oauth</code> and one named <code>sc.httr-oauth</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(googleAuthR)
<span class="kw">library</span>(googleAnalyticsR)
<span class="kw">library</span>(searchConsoleR)

<span class="co"># start with google analytics auth</span>
<span class="kw"><a href="../reference/gar_auth.html">gar_auth</a></span>(<span class="st">"ga.httr-oauth"</span>)

<span class="co"># can run Google Analytics API calls:</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/googleAnalyticsR/topics/ga_account_list">ga_account_list</a></span>()

<span class="co"># switch to Seach Console auth</span>
<span class="kw"><a href="../reference/gar_auth.html">gar_auth</a></span>(<span class="st">"sc.httr-oauth"</span>)

<span class="co"># can now run Search Console API calls:</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/searchConsoleR/topics/list_websites">list_websites</a></span>()</code></pre></div>
<p>Alternatively, you can authenticate with both API services in the same token by specifying the scopes for the request - this determines what permission screen you get the first time you go through the OAuth2 flow.</p>
<p>You can access the scopes you required via the <code>googleAuthR</code> RStudio plugin.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(googleAuthR)
<span class="kw">library</span>(googleAnalyticsR)
<span class="kw">library</span>(searchConsoleR)

<span class="co"># set the scopes required</span>
<span class="kw">options</span>(<span class="dt">googleAuthR.scopes.selected =</span> <span class="kw">c</span>(<span class="st">"https://www.googleapis.com/auth/analytics"</span>, 
                                        <span class="st">"https://www.googleapis.com/auth/webmasters"</span>))
                                        
<span class="co"># you may also set the client id and secret here as well</span>
<span class="kw">options</span>(<span class="dt">googleAuthR.client_id =</span> <span class="st">"XXXXXXX"</span>,
        <span class="dt">googleAuthR.client_secret =</span> <span class="st">"XXXXXX"</span>)

<span class="co"># authenticate and go through the OAuth2 flow first time - specify a filename to save to by passing it in</span>
<span class="kw"><a href="../reference/gar_auth.html">gar_auth</a></span>(<span class="dt">token =</span> <span class="st">"sc_ga.httr-oauth"</span>)
                                        
<span class="co"># can run Google Analytics API calls:</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/googleAnalyticsR/topics/ga_account_list">ga_account_list</a></span>()

<span class="co"># and run Search Console API calls:</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/searchConsoleR/topics/list_websites">list_websites</a></span>()</code></pre></div>
</div>
</div>
<div id="authentication-with-no-browser" class="section level1">
<h1 class="hasAnchor">
<a href="#authentication-with-no-browser" class="anchor"></a>Authentication with no browser</h1>
<p>If for some reason you need authentication without access to a browser (for example when using Shiny Server), then you can authenticate locally and upload the <code>.httr-oauth</code> file to the folder of your script.</p>
</div>
<div id="authentication-with-a-json-file-via-service-accounts" class="section level1">
<h1 class="hasAnchor">
<a href="#authentication-with-a-json-file-via-service-accounts" class="anchor"></a>Authentication with a JSON file via Service Accounts</h1>
<p>You can also authenticate single users via a server side JSON file rather than going through the online OAuth2 flow. The end user could supply this JSON file, or you can upload your own JSON file to your applications. This is generally more secure if you know its only one user on the service, such as for Cloud services.</p>
<p>This involves downloading a secret JSON key with the authentication details. More details are available from Google here: Using OAuth2.0 for Server to Server Applications[<a href="https://developers.google.com/identity/protocols/OAuth2ServiceAccount" class="uri">https://developers.google.com/identity/protocols/OAuth2ServiceAccount</a>]</p>
<p>To use, go to your Project in the Google Developement Console and select JSON Key type. Save the JSON file to your computer and supply the file location to the function <code><a href="../reference/gar_auth_service.html">gar_auth_service()</a></code></p>
<p>Navigate to the JSON file from the Google Developer Console via: <code>Credentials &gt; New credentials &gt; Service account Key &gt; Select service account &gt; Key type = JSON</code></p>
<p>If you are using the JSON file, you must ensure:</p>
<ul>
<li>The service email has access to the resource you are trying to fetch (for example a Google Analytics View)</li>
<li>You have set the scopes to the correct API</li>
<li>The Google Project has the API turned on</li>
</ul>
<p>An example using a service account JSON file for authentication is shown below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(googleAuthR)
<span class="kw">options</span>(<span class="dt">googleAuthR.scopes.selected =</span> <span class="st">"https://www.googleapis.com/auth/urlshortner"</span>)
service_token &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gar_auth_service.html">gar_auth_service</a></span>(<span class="dt">json_file=</span><span class="st">"~/location/of/the/json/secret.json"</span>)
analytics_url &lt;-<span class="st"> </span><span class="cf">function</span>(shortUrl, 
                          <span class="dt">timespan =</span> <span class="kw">c</span>(<span class="st">"allTime"</span>, <span class="st">"month"</span>, <span class="st">"week"</span>,<span class="st">"day"</span>,<span class="st">"twoHours"</span>)){
  
  timespan &lt;-<span class="st"> </span><span class="kw">match.arg</span>(timespan)
  
  f &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gar_api_generator.html">gar_api_generator</a></span>(<span class="st">"https://www.googleapis.com/urlshortener/v1/url"</span>,
                         <span class="st">"GET"</span>,
                         <span class="dt">pars_args =</span> <span class="kw">list</span>(<span class="dt">shortUrl =</span> <span class="st">"shortUrl"</span>,
                                          <span class="dt">projection =</span> <span class="st">"FULL"</span>),
                         <span class="dt">data_parse_function =</span> <span class="cf">function</span>(x) { 
                           a &lt;-<span class="st"> </span>x<span class="op">$</span>analytics 
                           <span class="kw">return</span>(a[timespan][[<span class="dv">1</span>]])
                         })
  
  <span class="kw">f</span>(<span class="dt">pars_arguments =</span> <span class="kw">list</span>(<span class="dt">shortUrl =</span> shortUrl))
}
<span class="kw">analytics_url</span>(<span class="st">"https://goo.gl/2FcFVQbk"</span>)</code></pre></div>
<p>Another example is from the <code>searchConsoleR</code> library - in this case we avoid using <code><a href="http://www.rdocumentation.org/packages/searchConsoleR/topics/scr_auth">scr_auth()</a></code> to authenticate via the JSON, which has had the service email added to the Search Console web property as a user.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(googleAuthR)
<span class="kw">library</span>(searchConsoleR)
<span class="kw">options</span>(<span class="dt">googleAuthR.scopes.selected =</span> <span class="st">"https://www.googleapis.com/auth/webmasters"</span>) 

<span class="kw"><a href="../reference/gar_auth_service.html">gar_auth_service</a></span>(<span class="st">"auth.json"</span>)

<span class="kw"><a href="http://www.rdocumentation.org/packages/searchConsoleR/topics/list_websites">list_websites</a></span>()</code></pre></div>
</div>
<div id="authentication-within-shiny" class="section level1">
<h1 class="hasAnchor">
<a href="#authentication-within-shiny" class="anchor"></a>Authentication within Shiny</h1>
<p>If you want to create a Shiny app just using your data, upload the app with your own <code>.httr-oauth</code>.</p>
<p>If you want to make a multi-user Shiny app, where users login to their own Google account and the app works with their data, googleAuthR provides these functions to help make the Google login process as easy as possible.</p>
<p>As of 0.3.0 googleAuthR uses <a href="http://shiny.rstudio.com/articles/modules.html">Shiny Modules</a>. This means less code and the ability to have multiple login buttons on the same app.</p>
<ul>
<li>
<code>googleAuth</code> - creates the authentication token and login button styling</li>
<li>
<code>googleAuthUI</code> - creates the server side login button for users to authenticate with.</li>
<li>
<code><a href="../reference/with_shiny.html">with_shiny()</a></code> - wraps your API functions so they can be passed the user’s authentication token.</li>
</ul>
<div id="shiny-authentication-example" class="section level2">
<h2 class="hasAnchor">
<a href="#shiny-authentication-example" class="anchor"></a>Shiny authentication example</h2>
<p>This is the example <a href="https://mark.shinyapps.io/googleAuthRexample/">deployed to shinyapps.io here</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## in global.R
<span class="kw">library</span>(googleAuthR)
<span class="kw">library</span>(shiny)
<span class="kw">options</span>(<span class="dt">googleAuthR.scopes.selected =</span> <span class="st">"https://www.googleapis.com/auth/urlshortener"</span>)
<span class="kw">options</span>(<span class="dt">googleAuthR.webapp.client_id =</span> <span class="st">"YOUR_PROJECT_KEY"</span>)
<span class="kw">options</span>(<span class="dt">googleAuthR.webapp.client_secret =</span> <span class="st">"YOUR_CLIENT_SECRET"</span>)
shorten_url &lt;-<span class="st"> </span><span class="cf">function</span>(url){
  
  body =<span class="st"> </span><span class="kw">list</span>(
    <span class="dt">longUrl =</span> url
  )
  
  f &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gar_api_generator.html">gar_api_generator</a></span>(<span class="st">"https://www.googleapis.com/urlshortener/v1/url"</span>,
                         <span class="st">"POST"</span>,
                         <span class="dt">data_parse_function =</span> <span class="cf">function</span>(x) x<span class="op">$</span>id)
  
  <span class="kw">f</span>(<span class="dt">the_body =</span> body)
  
}
## server.R
<span class="kw">source</span>(<span class="st">"global.R"</span>)
server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session){
  
  ## Create access token and render login button
  access_token &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/shiny/topics/callModule">callModule</a></span>(googleAuth, <span class="st">"loginButton"</span>)
  
  short_url_output &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/shiny/topics/observeEvent">eventReactive</a></span>(input<span class="op">$</span>submit, {
    ## wrap existing function with_shiny
    ## pass the reactive token in shiny_access_token
    ## pass other named arguments
    <span class="kw"><a href="../reference/with_shiny.html">with_shiny</a></span>(<span class="dt">f =</span> shorten_url, 
               <span class="dt">shiny_access_token =</span> <span class="kw">access_token</span>(),
               <span class="dt">url=</span>input<span class="op">$</span>url)
    
  })
  
  output<span class="op">$</span>short_url &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/shiny/topics/renderText">renderText</a></span>({
    
    <span class="kw">short_url_output</span>()
    
  })
}
## ui.R
ui &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/shiny/topics/fluidPage">fluidPage</a></span>(
  <span class="kw"><a href="../reference/googleAuthUI.html">googleAuthUI</a></span>(<span class="st">"loginButton"</span>),
  <span class="kw"><a href="http://www.rdocumentation.org/packages/shiny/topics/textInput">textInput</a></span>(<span class="st">"url"</span>, <span class="st">"Enter URL"</span>),
  <span class="kw"><a href="http://www.rdocumentation.org/packages/shiny/topics/actionButton">actionButton</a></span>(<span class="st">"submit"</span>, <span class="st">"Shorten URL"</span>),
  <span class="kw"><a href="http://www.rdocumentation.org/packages/shiny/topics/textOutput">textOutput</a></span>(<span class="st">"short_url"</span>)
)
### If the above global.R, server.R and ui.R files are in folder "test" like so:
## /home
##    |-&gt;/test/
##            /global.R
##            /ui.R
##            /server.R
##
## Port 1221 has been set in your Google Project options as the port to listen to
## as explained in authentication setup section
## run below in /home directory
shiny<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/shiny/topics/runApp">runApp</a></span>(<span class="st">"./test/"</span>, <span class="dt">launch.browser=</span>T, <span class="dt">port=</span><span class="dv">1221</span>)</code></pre></div>
<p>By default the logout button causes a disconnect form the server, but you can use <code>shinyjs</code> to improve the user experience via this bit of code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/shiny/topics/observe">observe</a></span>({
    <span class="cf">if</span> (rv<span class="op">$</span>login) {
        shinyjs<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/shinyjs/topics/onevent">onclick</a></span>(<span class="st">"gauth_login-googleAuthUi"</span>,
            shinyjs<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/shinyjs/topics/runjs">runjs</a></span>(<span class="st">"window.location.href = 'https://yourdomain.shinyapps.io/appName';"</span>))
    }
})</code></pre></div>
<p>See this post on <a href="https://lesliemyint.wordpress.com/2017/01/01/creating-a-shiny-app-with-google-login/">creating a Shiny App with a Google login</a> for details.</p>
</div>
</div>
<div id="authentication-via-rstudio-addin" class="section level1">
<h1 class="hasAnchor">
<a href="#authentication-via-rstudio-addin" class="anchor"></a>Authentication via RStudio Addin</h1>
<p>From version <code>0.3.0</code> a RStudio Addin is available via the RStudio Addin menu once you load the package, or via <code>googleAuthR:::gar_gadget()</code></p>
<p>It lets you set the scopes and then saves you some typing by calling the Google authentication flow for you.</p>
</div>
<div id="authentication-in-rmarkdown-via-javascript" class="section level1">
<h1 class="hasAnchor">
<a href="#authentication-in-rmarkdown-via-javascript" class="anchor"></a>Authentication in RMarkdown via JavaScript</h1>
<p>From version <code>0.4.0</code> there are two functions that can be called from within RMarkdown for authentication. They use JavaScript, rather than R/Shiny to authenticate, as an RMarkdown document can not read the URL tokens.</p>
<p>A demo and example are available here: <code>https://mark.shinyapps.io/googleAuthRMarkdown/</code></p>
<div id="rmarkdown-authentication---setup" class="section level2">
<h2 class="hasAnchor">
<a href="#rmarkdown-authentication---setup" class="anchor"></a>RMarkdown authentication - Setup</h2>
<p>The RMarkdown document YAML needs runtime shiny and to be a HTML document:</p>
<pre><code>output: html_document
runtime: shiny</code></pre>
<p>Locally, you have to run the RMarkdown document on the specified port configured in Google console (<code>1221</code> for the default shared project of <code>googleAuthR</code>), configured via <code>options(shiny.port = 1221)</code></p>
<p>This means you shouldn’t launch the RMarkdown via the Run button in RStudio as that starts a new R session without your set options.</p>
<p>Instead set the options and run via <code><a href="http://www.rdocumentation.org/packages/rmarkdown/topics/run">rmarkdown::run("myfile.Rmd")</a></code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">options</span>(<span class="dt">shiny.port =</span> <span class="dv">1221</span>)
<span class="kw">options</span>(<span class="dt">googleAuthR.scopes.selected =</span> <span class="st">"https://www.googleapis.com/auth/plus.me"</span>)
rmarkdown<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rmarkdown/topics/run">run</a></span>(<span class="st">"googleAuthRMarkdown.Rmd"</span>)</code></pre></div>
<p>When publishing, you also need to add the domain to the Javascript origins in the Google API console. Use <code>127.0.0.1:XXX</code> where XXX is your chosen Shiny port for local testing.</p>
</div>
<div id="example-of-rmarkdown-authentication" class="section level2">
<h2 class="hasAnchor">
<a href="#example-of-rmarkdown-authentication" class="anchor"></a>Example of RMarkdown authentication</h2>
<p>Below creates a button that when clicked makes a popup for Google authentication:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(googleAuthR)

<span class="kw"><a href="../reference/gar_auth_jsUI.html">gar_auth_jsUI</a></span>(<span class="st">"auth_demo"</span>, <span class="dt">login_text =</span> <span class="st">"Click Me"</span>)</code></pre></div>
<p>The authentication token is available via the server side module command:</p>
<pre><code>auth &lt;- callModule(gar_auth_js, "auth_demo")</code></pre>
<p>Pass the auth token to API functions. Below example using googleID to return G+ user info.</p>
<pre><code># devtools::install_github("MarkEdmondson1234/googleID")
library(googleID)

user_info &lt;- reactive({
  
  req(auth())
  
  with_shiny(get_user_info,
             shiny_access_token = auth())
  
})</code></pre>
<p>You can now output the user data taken from the G+ API:</p>
<pre><code><a href="http://www.rdocumentation.org/packages/shiny/topics/renderUI">## creates an output
renderUI({
  
  req(user_info())
  
  h1("Hello ", user_info()$displayName)
  
})</a></code></pre>
</div>
</div>
<div id="auto-authentication" class="section level1">
<h1 class="hasAnchor">
<a href="#auto-authentication" class="anchor"></a>Auto-authentication</h1>
<p>From version <code>0.4.0</code> auto-authentication can be performed upon a package load.</p>
<p>This requires the setup of environment variables either in your <code>.Renviron</code> file or via <code>Sys.setenv()</code> to point to a previously created authentication file. This file can be either a <code>.httr-oauth</code> file created via <code><a href="../reference/gar_auth.html">gar_auth()</a></code> or a Google service account JSON downloaded from the Google API console.</p>
<p>This file will then be used for authentication via <code>gar_auth_auto</code>. You can call this function yourself in scripts or R sessions, but its main intention is to be called in the <code>.onAttach</code> function via <code>gar_attach_auth_auto</code>, so that you will authenticate right after you load the library via <code>library(yourlibrary)</code></p>
<p>An example from <code>googleCloudStorageR</code> is shown below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">.onAttach &lt;-<span class="st"> </span><span class="cf">function</span>(libname, pkgname){

  googleAuthR<span class="op">::</span><span class="kw"><a href="https://code.markedmondson.me/googleAuthR//reference/gar_attach_auto_auth.html">gar_attach_auto_auth</a></span>(<span class="st">"https://www.googleapis.com/auth/devstorage.full_control"</span>,
                                    <span class="dt">environment_var =</span> <span class="st">"GCS_AUTH_FILE"</span>)
}</code></pre></div>
<p>..which calls an environment variable set in <code>~/.Renvion</code>:</p>
<pre><code>GCS_AUTH_FILE="/Users/mark/auth/my_auth_file.json"</code></pre>
</div>
<div id="revoking-authentication" class="section level1">
<h1 class="hasAnchor">
<a href="#revoking-authentication" class="anchor"></a>Revoking Authentication</h1>
<p>For local use, delete the <code>.httr-oauth</code> file.</p>
<p>For service level accounts delete the JSON file.</p>
<p>For a Shiny app, a cookie is left by Google that will mean a faster login next time a user uses the app with no Authorization screen that they get the first time through. To force this every time, activate the parameter <code>revoke=TRUE</code> within the <code>googleAuth</code> function.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#basic">Basic</a><ul class="nav nav-pills nav-stacked">
<li><a href="#multiple-authentication-tokens">Multiple authentication tokens</a></li>
      </ul>
</li>
      <li><a href="#authentication-with-no-browser">Authentication with no browser</a></li>
      <li><a href="#authentication-with-a-json-file-via-service-accounts">Authentication with a JSON file via Service Accounts</a></li>
      <li>
<a href="#authentication-within-shiny">Authentication within Shiny</a><ul class="nav nav-pills nav-stacked">
<li><a href="#shiny-authentication-example">Shiny authentication example</a></li>
      </ul>
</li>
      <li><a href="#authentication-via-rstudio-addin">Authentication via RStudio Addin</a></li>
      <li>
<a href="#authentication-in-rmarkdown-via-javascript">Authentication in RMarkdown via JavaScript</a><ul class="nav nav-pills nav-stacked">
<li><a href="#rmarkdown-authentication---setup">RMarkdown authentication - Setup</a></li>
      <li><a href="#example-of-rmarkdown-authentication">Example of RMarkdown authentication</a></li>
      </ul>
</li>
      <li><a href="#auto-authentication">Auto-authentication</a></li>
      <li><a href="#revoking-authentication">Revoking Authentication</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://code.markedmondson.me">Mark Edmondson</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
