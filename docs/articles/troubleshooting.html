<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Troubleshooting Authentication • googleAuthR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Troubleshooting Authentication">
<meta property="og:description" content="googleAuthR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-47480439-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-47480439-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">googleAuthR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/setup.html">
    <span class="fa fa-child fa-lg"></span>
     
    Setup
  </a>
</li>
<li>
  <a href="../articles/google-authentication-types.html">
    <span class="fa fa-sign-in fa-lg"></span>
     
    Authentication
  </a>
</li>
<li>
  <a href="../articles/building.html">
    <span class="fa fa-wrench fa-lg"></span>
     
    Building Google APIs
  </a>
</li>
<li>
  <a href="../articles/advanced-building.html">
    <span class="fa fa-space-shuttle fa-lg"></span>
     
    Advanced APIs
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Help
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../reference/index.html">Reference</a>
    </li>
    <li>
      <a href="../news/index.html">News</a>
    </li>
    <li>
      <a href="../articles/troubleshooting.html">Troubleshooting</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://developers.google.com/apis-explorer/">
    <span class="fa fa-google fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/MarkEdmondson1234/googleAuthR/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://docs.google.com/forms/d/e/1FAIpQLSerjirmMpB3b7LmBs_Vx_XPIE9IrhpCpPg1jUcpfBcivA3uBw/viewform">
    <span class="fa fa-slack fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Troubleshooting Authentication</h1>
                        <h4 class="author">Mark Edmondson</h4>
            
            <h4 class="date">2020-12-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MarkEdmondson1234/googleAuthR/blob/master/vignettes/troubleshooting.Rmd"><code>vignettes/troubleshooting.Rmd</code></a></small>
      <div class="hidden name"><code>troubleshooting.Rmd</code></div>

    </div>

    
    
<p>This document hopefully helps troubleshoot authentication troubles. If anything is not covered, please raise an issue on GitHub.</p>
<div id="helpful-resources" class="section level2">
<h2 class="hasAnchor">
<a href="#helpful-resources" class="anchor"></a>Helpful Resources</h2>
<div id="setting-your-own-client-id" class="section level3">
<h3 class="hasAnchor">
<a href="#setting-your-own-client-id" class="anchor"></a>Setting your own client ID</h3>
<p><a href="http://donalphipps.co.uk/">Donal Phipps</a> has a helpful video on how to set up your own Google Project client ID and secret via <a href="https://www.youtube.com/watch?v=4B88dRbwNfc">this link</a> - its for <code>googleAnalyticsR</code> but applies for all <code>googleAuthR</code> packages.</p>
<iframe width="560" height="315" src="http://www.youtube.com/embed/4B88dRbwNfc?rel=0" frameborder="0" allowfullscreen>
</iframe>
</div>
</div>
<div id="understanding-authentication" class="section level2">
<h2 class="hasAnchor">
<a href="#understanding-authentication" class="anchor"></a>Understanding authentication</h2>
<p>Generally, successful authentication needs the following in place:</p>
<ul>
<li>A client ID and secret</li>
<li>API scopes</li>
<li>Permission from a user</li>
</ul>
<p>A lot of the time the first two are set by the package and the end user does not need to worry about them. They are set via these options:</p>
<ul>
<li>A client ID and secret - <code><a href="https://rdrr.io/r/base/options.html">option("googleAuthR.client_id")</a></code> and <code><a href="https://rdrr.io/r/base/options.html">option("googleAuthR.client_secret")</a></code>
</li>
<li>API scopes - <code><a href="https://rdrr.io/r/base/options.html">option("googleAuthR.scopes.selected")</a></code>
</li>
<li>Permission from a user - Done via the OAuth2 login screen on call to <code><a href="../reference/gar_auth.html">googleAuthR::gar_auth()</a></code>
</li>
</ul>
<p>Once authentication has been done, then the authentication details are kept in a <em>cache file</em>, which by default is called <code>.httr-oauth</code> and appears in your working directory.</p>
<p>This file location is set via <code><a href="https://rdrr.io/r/base/options.html">option("googleAuthR.httr_oauth_cache")</a></code>, or when you pass a filename to <code><a href="../reference/gar_auth.html">gar_auth(token = "filename")</a></code> it will set it to the <code>filename</code> you pass in.</p>
<p>At the same time a token is written to the R session into a global object, for use in the functions. On any restart of the R session, or if the token expires (default 60 mins) the cache file is looked for to reload it into the R session.</p>
<div id="gar_auth-options" class="section level3">
<h3 class="hasAnchor">
<a href="#gar_auth-options" class="anchor"></a>gar_auth() options</h3>
<p>Several libraries wrap <code><a href="../reference/gar_auth.html">googleAuthR::gar_auth()</a></code> with presets, so you don’t call them directly e.g. <code>ga_auth()</code> in <code>googleAnalyticsR</code>. Use <code><a href="../reference/gar_auth.html">googleAuthR::gar_auth()</a></code> instead of native authentication function if you want more control.</p>
<p>If you call <code><a href="../reference/gar_auth.html">googleAuthR::gar_auth()</a></code> then it will look for a cache token given by <code><a href="https://rdrr.io/r/base/options.html">option("googleAuthR.httr_oauth_cache")</a></code> or the filename you pass in - if not present it will trigger the OAuth2 flow.</p>
<p>If you call <code><a href="../reference/gar_auth.html">googleAuthR::gar_auth("token_name")</a></code> then it will look for a cache token given by <code>"token_name"</code> and <em>set the <code><a href="https://rdrr.io/r/base/options.html">option("googleAuthR.httr_oauth_cache")</a></code> to <code>"token_name"</code></em>. This means refreshes etc. will be to that token cache file. It will also set the client ID, client secret and scopes to that specified in the file.</p>
</div>
<div id="common-errors" class="section level3">
<h3 class="hasAnchor">
<a href="#common-errors" class="anchor"></a>Common errors</h3>
<p>If for any reason any of the above change inbetween you authenticating and calling the API, then you may get an error or need to reauthenticate.</p>
<ul>
<li>The <code><a href="https://rdrr.io/r/base/options.html">option("googleAuthR.client_id")</a></code> or <code><a href="https://rdrr.io/r/base/options.html">option("googleAuthR.client_secret")</a></code> are changed by loading another library or setting them in a script, and then a cache file is used with different options set.<br>
</li>
<li>The cache file is not where you expect it to be, or is deleted. The script will typically look in its working directory, which for say scheduled scripts may be different than the one you made the token within.</li>
<li>If the cache file doesn’t match the credentials the script needs, it will attempt to manually reauthenticate. If in a scheduled script, as this needs manual intervention, this will result in an error.</li>
<li>If using JSON service authentication via <code><a href="../reference/gar_auth_service.html">gar_auth_service()</a></code> make sure the service email is an authenticated user with the service you are trying to access, and your Google Project has the right API turned on.</li>
<li>If you get an error from the API like <code>Error in init_oauth_service_account(self$secrets, scope = self$params$scope, : Bad Request (HTTP 400).</code> then your auth request is probably malformed. Check you have set the scopes and clientID/secret correctly.</li>
</ul>
</div>
<div id="tips-and-tricks" class="section level3">
<h3 class="hasAnchor">
<a href="#tips-and-tricks" class="anchor"></a>Tips and tricks</h3>
<ul>
<li>Use <code><a href="../reference/gar_token_info.html">googleAuthR::gar_token_info(2)</a></code> to check your current token, and validate it with <code><a href="../reference/gar_check_existing_token.html">googleAuthR::gar_check_existing_token()</a></code> which should return <code>TRUE</code>. Make sure it matches your expectations.</li>
<li>If in doubt, delete the cache file, restart your R session and reauthenticate.</li>
<li>Set your options within the script before you authenticate, but after you load the library to ensure they are what you think they are:</li>
</ul>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">googleAnalyticsR</span>)

<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="kw">googleAuthR.client_id</span> <span class="kw">=</span> <span class="st">"XXXX"</span>, <span class="kw">googleAuthR.client_secret</span> <span class="kw">=</span> <span class="st">"XXXX"</span>)

<span class="co">## wraps `googleAuthR::gar_auth()`</span>
<span class="fu">ga_auth</span>()</pre></body></html></div>
<ul>
<li>If you are always going to use the same credentials, make use of the auto authentication options by creating a cache token, moving it to a dedicated auth folder and using environment variables <code>GAR_AUTH</code> or package supported ones.</li>
<li>If you are using auto-authentication, make sure this doesn’t clash with manual authentication. Comment out the environment variable if needed as this will prevent it operating on package load.</li>
<li>The safest way is to specify the filename of the token you are authenticating from:</li>
</ul>
<p><code><a href="../reference/gar_auth.html">gar_auth("my_token.httr-oauth")</a></code></p>
<ul>
<li>Safest way to specify your client id and secret is to download the client ID JSON, create a environment variable <code>GAR_CLIENT_JSON</code> and use <code><a href="../reference/gar_set_client.html">gar_set_client()</a></code>
</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://code.markedmondson.me">Mark Edmondson</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
