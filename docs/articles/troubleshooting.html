<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Troubleshooting Authentication • googleAuthR</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Google analytics --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47480439-2', 'auto');
  ga('send', 'pageview');

</script>
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">googleAuthR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/google-authentication-types.html">
    <span class="fa fa-sign-in fa-lg"></span>
     
    Authentication
  </a>
</li>
<li>
  <a href="../articles/building.html">
    <span class="fa fa-wrench fa-lg"></span>
     
    Building Google APIs
  </a>
</li>
<li>
  <a href="../articles/advanced-building.html">
    <span class="fa fa-space-shuttle fa-lg"></span>
     
    Advanced APIs
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Help
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../reference/index.html">Reference</a>
    </li>
    <li>
      <a href="../news/index.html">News</a>
    </li>
    <li>
      <a href="../articles/troubleshooting.html">Troubleshooting</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://developers.google.com/apis-explorer/">
    <span class="fa fa-google fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/MarkEdmondson1234/googleAuthR/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://docs.google.com/forms/d/e/1FAIpQLSerjirmMpB3b7LmBs_Vx_XPIE9IrhpCpPg1jUcpfBcivA3uBw/viewform">
    <span class="fa fa-slack fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Troubleshooting Authentication</h1>
                        <h4 class="author">Mark Edmondson</h4>
            
            <h4 class="date">2017-11-11</h4>
          </div>

    
    
<div class="contents">
<p>This document hopefully helps troubleshoot authentication troubles. If anything is not covered, please raise an issue on GitHub.</p>
<div id="helpful-resources" class="section level2">
<h2 class="hasAnchor">
<a href="#helpful-resources" class="anchor"></a>Helpful Resources</h2>
<div id="setting-your-own-client-id" class="section level3">
<h3 class="hasAnchor">
<a href="#setting-your-own-client-id" class="anchor"></a>Setting your own client ID</h3>
<p><a href="http://donalphipps.co.uk/">Donal Phipps</a> has a helpful video on how to set up your own Google Project client ID and secret via <a href="https://www.youtube.com/watch?v=4B88dRbwNfc">this link</a> - its for <code>googleAnalyticsR</code> but applies for all <code>googleAuthR</code> packages.</p>
<iframe width="560" height="315" src="http://www.youtube.com/embed/4B88dRbwNfc?rel=0" frameborder="0" allowfullscreen>
</iframe>
</div>
</div>
<div id="understanding-authentication" class="section level2">
<h2 class="hasAnchor">
<a href="#understanding-authentication" class="anchor"></a>Understanding authentication</h2>
<p>Generally, successful authentication needs the following in place:</p>
<ul>
<li>A client ID and secret</li>
<li>API scopes</li>
<li>Permission from a user</li>
</ul>
<p>A lot of the time the first two are set by the package and the end user does not need to worry about them. They are set via these options:</p>
<ul>
<li>A client ID and secret - <code>option("googleAuthR.client_id")</code> and <code>option("googleAuthR.client_secret")</code>
</li>
<li>API scopes - <code>option("googleAuthR.scopes.selected")</code>
</li>
<li>Permission from a user - Done via the OAuth2 login screen on call to <code><a href="https://code.markedmondson.me/googleAuthR//reference/gar_auth.html">googleAuthR::gar_auth()</a></code>
</li>
</ul>
<p>Once authentication has been done, then the authentication details are kept in a <em>cache file</em>, which by default is called <code>.httr-oauth</code> and appears in your working directory.</p>
<p>This file location is set via <code>option("googleAuthR.httr_oauth_cache")</code>, or when you pass a filename to <code><a href="../reference/gar_auth.html">gar_auth(token = "filename")</a></code> it will set it to the <code>filename</code> you pass in.</p>
<p>At the same time a token is written to the R session into a global object, for use in the functions. On any restart of the R session, or if the token expires (default 60 mins) the cache file is looked for to reload it into the R session.</p>
<div id="gar_auth-options" class="section level3">
<h3 class="hasAnchor">
<a href="#gar_auth-options" class="anchor"></a>gar_auth() options</h3>
<p>Several libraries wrap <code><a href="https://code.markedmondson.me/googleAuthR//reference/gar_auth.html">googleAuthR::gar_auth()</a></code> with presets, so you don’t call them directly e.g. <code><a href="http://www.rdocumentation.org/packages/googleAnalyticsR/topics/ga_auth">ga_auth()</a></code> in <code>googleAnalyticsR</code>. Use <code><a href="https://code.markedmondson.me/googleAuthR//reference/gar_auth.html">googleAuthR::gar_auth()</a></code> instead of native authentication function if you want more control.</p>
<p>If you call <code><a href="https://code.markedmondson.me/googleAuthR//reference/gar_auth.html">googleAuthR::gar_auth()</a></code> then it will look for a cache token given by <code>option("googleAuthR.httr_oauth_cache")</code> or the filename you pass in - if not present it will trigger the OAuth2 flow.</p>
<p>If you call <code><a href="https://code.markedmondson.me/googleAuthR//reference/gar_auth.html">googleAuthR::gar_auth("token_name")</a></code> then it will look for a cache token given by <code>"token_name"</code> and <em>set the <code>option("googleAuthR.httr_oauth_cache")</code> to <code>"token_name"</code></em>. This means refreshes etc. will be to that token cache file. It will also set the client ID, client secret and scopes to that specified in the file.</p>
</div>
<div id="common-errors" class="section level3">
<h3 class="hasAnchor">
<a href="#common-errors" class="anchor"></a>Common errors</h3>
<p>If for any reason any of the above change inbetween you authenticating and calling the API, then you may get an error or need to reauthenticate.</p>
<ul>
<li>The <code>option("googleAuthR.client_id")</code> or <code>option("googleAuthR.client_secret")</code> are changed by loading another library or setting them in a script, and then a cache file is used with different options set.<br>
</li>
<li>The cache file is not where you expect it to be, or is deleted. The script will typically look in its working directory, which for say scheduled scripts may be different than the one you made the token within.</li>
<li>If the cache file doesn’t match the credentials the script needs, it will attempt to manually reauthenticate. If in a scheduled script, as this needs manual intervention, this will result in an error.</li>
<li>If using JSON service authentication via <code><a href="../reference/gar_auth_service.html">gar_auth_service()</a></code> make sure the service email is an authenticated user with the service you are trying to access, and your Google Project has the right API turned on.</li>
</ul>
</div>
<div id="tips-and-tricks" class="section level3">
<h3 class="hasAnchor">
<a href="#tips-and-tricks" class="anchor"></a>Tips and tricks</h3>
<ul>
<li>Use <code><a href="https://code.markedmondson.me/googleAuthR//reference/gar_token_info.html">googleAuthR::gar_token_info(2)</a></code> to check your current token, and validate it with <code><a href="https://code.markedmondson.me/googleAuthR//reference/gar_check_existing_token.html">googleAuthR::gar_check_existing_token()</a></code> which should return <code>TRUE</code>. Make sure it matches your expectations.</li>
<li>If in doubt, delete the cache file, restart your R session and reauthenticate.</li>
<li>Set your options within the script before you authenticate, but after you load the library to ensure they are what you think they are:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(googleAnalyticsR)

<span class="kw">options</span>(<span class="dt">googleAuthR.client_id =</span> <span class="st">"XXXX"</span>, <span class="dt">googleAuthR.client_secret =</span> <span class="st">"XXXX"</span>)

## wraps `googleAuthR::gar_auth()`
<span class="kw"><a href="http://www.rdocumentation.org/packages/googleAnalyticsR/topics/ga_auth">ga_auth</a></span>()</code></pre></div>
<ul>
<li>If you are always going to use the same credentials, make use of the auto authentication options by creating a cache token, moving it to a dedicated auth folder and using environment variables <code>GAR_AUTH</code> or package supported ones.</li>
<li>If you are using auto-authentication, make sure this doesn’t clash with manual authentication. Comment out the environment variable if needed as this will prevent it operating on package load.</li>
<li>The safest way is to specify the filename of the token you are authenticating from:</li>
</ul>
<p><code><a href="../reference/gar_auth.html">gar_auth("my_token.httr-oauth")</a></code></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#helpful-resources">Helpful Resources</a></li>
      <li><a href="#understanding-authentication">Understanding authentication</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://code.markedmondson.me">Mark Edmondson</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
